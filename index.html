<!DOCTYPE html>
<html class="no-js">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title></title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Fabric JS Library -->
    <script src="javascript/vendor/fabric.min.js"></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/@r-tek/colr_pickr@1.2.0/build/colr_pickr.min.css"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body>
    <div class="big-container">
      <div class="flexRow">
        <div id="container canvas-container" class="canvas-container">
          <canvas
            id="canvas-real"
            class="canvas"
            width="700px"
            height="500px"
          ></canvas>
          <canvas
            id="canvas-draft"
            class="canvas"
            width="700px"
            height="500px"
          ></canvas>
        </div>
        <div class="buttons side-car">
          <!-- The drawing rectangle button  -->
          <button class="btn btn-outline-info" id="drawing-rectangle">
            <img src="assets/icons/frame.svg" />
          </button>
          <!-- The drawing triangle button  -->
          <button class="btn btn-outline-info" id="drawing-triangle">
            <img src="assets/icons/triangular.svg" />
          </button>
          <!-- The drawing polygon button  -->
          <button class="btn btn-outline-info" id="drawing-polygon">
            <img src="assets/icons/polygon.svg" />
          </button>
          <!-- The drawing straight-line button  -->
          <button class="btn btn-outline-info" id="drawing-straight-line">
            <img src="assets/icons/straight-line.svg" />
          </button>
          <!-- The drawing quadratic curve button  -->
          <button class="btn btn-outline-info" id="drawing-quadratic-curve">
            <img src="assets/icons/curve.svg" />
          </button>
          <!-- The drawing bezier curve button  -->
          <button class="btn btn-outline-info" id="drawing-bezier-curve">
            <img src="assets/icons/bezier.svg" />
          </button>
          <!-- The drawing line button  -->
          <button class="btn btn-outline-info" id="drawing-line">
            <img src="assets/icons/pen.svg" />
          </button>
          <!-- The drawing circle button  -->
          <button class="btn btn-outline-info" id="drawing-circle">
            <img src="assets/icons/circle.svg" />
          </button>
          <!-- The drawing text button  -->
          <button class="btn btn-outline-info" id="drawing-text">
            <img src="assets/icons/text.svg" />
          </button>
          <!-- The eraser button  -->
          <button class="btn btn-outline-info" id="eraser">
            <img src="assets/icons/eraser.svg" />
          </button>
          <!-- Color picker button -->
          <button id="my_picker">
            <span class="tooltiptext" id="tooltip1">Stroke Color</span>
          </button>
          <!-- Color picker button for fill color-->
          <button id="my_fill_color_picker">
            <span class="tooltiptext" id="tooltip2">Fill Color</span>
          </button>
        </div>
      </div>
      <div class="top-menu">
        <!-- The stamp button  -->
        <button class="btn btn-outline-info" id="stamp-rectangle">
          <img src="assets/icons/stamp.svg" />
        </button>
        <!-- collapse buttons -->
        <div class="collapse-button">
          <!-- The circle stamp button  -->
          <button class="btn btn-outline-info" id="AddCircle">
            <img src="assets/icons/circle.svg" />
          </button>
          <!-- The triangle stamp button  -->
          <button class="btn btn-outline-info" id="AddTriangle">
            <img src="assets/icons/triangular.svg" />
          </button>
          <!-- The rectangle stamp button  -->
          <button class="btn btn-outline-info" id="AddRect">
            <img src="assets/icons/frame.svg" />
          </button>
          <!-- The arrow stamp button  -->
          <button class="btn btn-outline-info" id="AddArrow">
            <img src="assets/icons/arrow.svg" />
          </button>
          <!-- The wizard stamp button  -->
          <button class="btn btn-outline-info" id="AddMagi">
            <img src="assets/icons/wizard.svg" />
          </button>
        </div>
        <!-- The clear button  -->
        <button class="btn btn-outline-info" id="clear">
          <img src="assets/icons/clear.svg" />
        </button>
        <!-- The fill-bucket button  -->
        <button class="btn btn-outline-info" id="fill-bucket">
          <img src="assets/icons/fill-bucket.svg" />
        </button>
        <!-- stroke width button -->
        <button
          class="btn btn-outline-info"
          type="button"
          data-toggle="collapse"
          data-target="#stroke-width-div"
          id="stroke-width-btn"
        >
          <img src="assets/icons/line-width.svg" />
        </button>
        <!-- stroke width slider -->
        <input
          type="range"
          id="stroke-width"
          min="2"
          max="40"
          value="2"
          title="Stroke Width"
        />
        <!-- The selection button  -->
        <button class="btn btn-outline-info" id="selection">
          <img src="assets/icons/selection-tool.svg" />
        </button>
        <!-- The redo button  -->
        <button class="btn btn-outline-info" id="redo">
          <img src="assets/icons/redo.svg" />
        </button>
        <!-- The undo button  -->
        <button class="btn btn-outline-info" id="undo">
          <img src="assets/icons/undo.svg" />
        </button>
        <!-- The save button  -->
        <button class="btn btn-outline-info" id="save">
          <img src="assets/icons/save.svg" />
        </button>
        <!-- The game button  -->
        <button class="btn btn-outline-info" id="game">
          <img src="assets/icons/game.svg" />
        </button>
      </div>
    </div>
    <!-- jQuery -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
      crossorigin="anonymous"
    ></script>
    <!-- Color Picker Library -->
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/@r-tek/colr_pickr@1.2.0/build/colr_pickr.min.js"
    ></script>
    <!-- declaring variables -->
    <script type="text/javascript" src="javascript/variables.js"></script>
    <!-- The drawing functionality  -->
    <script src="./javascript/canvas-common.js" type="text/javascript"></script>
    <!-- The drawing line functionality  -->
    <script src="./javascript/drawing-line.js" type="text/javascript"></script>
    <!-- The eraser functionality  -->
    <script src="./javascript/eraser.js" type="text/javascript"></script>
    <!-- The drawing rectangle functionality  -->
    <script
      src="./javascript/drawing-rectangle.js"
      type="text/javascript"
    ></script>
    <!-- The drawing text functionality -->
    <script src="./javascript/drawing-text.js" type="text/javascript"></script>
    <!-- The drawing circle functionality  -->
    <script
      src="./javascript/drawing-circle.js"
      type="text/javascript"
    ></script>
    <!-- The drawing polygon functionality  -->
    <script
      src="./javascript/drawing-polygon.js"
      type="text/javascript"
    ></script>
    <!-- The drawing triangle functionality  -->
    <script
      src="./javascript/drawing-triangle.js"
      type="text/javascript"
    ></script>
    <!-- The drawing straight line functionality  -->
    <script
      src="./javascript/drawing-straight-line.js"
      type="text/javascript"
    ></script>
    <!-- The drawing quadratic curve functionality  -->
    <script
      src="./javascript/drawing-quadratic-curve.js"
      type="text/javascript"
    ></script>
    <!-- The drawing bezier curve functionality  -->
    <script
      src="./javascript/drawing-bezier-curve.js"
      type="text/javascript"
    ></script>
    <!-- The save functionality  -->
    <script src="./javascript/save.js" type="text/javascript"></script>
    <!-- The clear functionality  -->
    <script src="./javascript/clear.js" type="text/javascript"></script>
    <!-- The fabric functionality  -->
    <script
      src="./javascript/detailsIntheFabric.js"
      type="text/javascript"
    ></script>
    <!-- The undo Redo -->
    <script src="./javascript/undoredo.js" type="text/javascript"></script>
    <!-- The fill bucket functionality  -->
    <script src="./javascript/fill-bucket.js" type="text/javascript"></script>
    <!-- The selection functionality  -->
    <script src="./javascript/selection.js" type="text/javascript"></script>
    <!-- The stroke width slider functionality  -->
    <script
      src="./javascript/stroke-width-slider.js"
      type="text/javascript"
    ></script>
    <!-- The game functionality  -->
    <script src="./javascript/game.js" type="text/javascript"></script>
    <!-- Color picker functionality -->
    <script type="text/javascript">
      const button = document.getElementById("my_picker");
      const fillButton = document.getElementById("my_fill_color_picker");
      let picker = new ColorPicker(button, curStroke);
      let fillPicker = new ColorPicker(fillButton, curFillColor);
      button.addEventListener("colorChange", function (event) {
        // This will give you the color you selected
        const color = event.detail.color.rgba;
        // Code to do what you want with that color...
        curStroke = color;
      });
      button.addEventListener("mouseover", (event) => {
        document.getElementById("tooltip1").style.visibility = "visible";
      });
      button.addEventListener("mouseleave", (event) => {
        document.getElementById("tooltip1").style.visibility = "hidden";
      });
      fillButton.addEventListener("mouseover", (event) => {
        document.getElementById("tooltip2").style.visibility = "visible";
      });
      fillButton.addEventListener("mouseleave", (event) => {
        document.getElementById("tooltip2").style.visibility = "hidden";
      });
      fillButton.addEventListener("colorChange", function (event) {
        // This will give you the color you selected
        const fillColor = event.detail.color.rgba;
        // Code to do what you want with that color...
        curFillColor = fillColor;
      });
    </script>
    <script type="text/javascript">
      $(() => {
        currentFunction = new DrawingLine(contextReal);
        $("#drawing-rectangle").click(() => {
          currentFunction = new DrawingRectangle(contextReal, contextDraft);
        });
        $("#drawing-line").click(() => {
          currentFunction = new DrawingLine(contextReal);
        });
        $("#eraser").click(() => {
          currentFunction = new Eraser(contextReal);
        });
        $("#drawing-circle").click(() => {
          currentFunction = new DrawingCircle(contextReal, contextDraft);
        });
        $("#drawing-text").click(() => {
          currentFunction = new DrawingText(contextReal, contextDraft);
        });
        $("#drawing-polygon").click(() => {
          currentFunction = new DrawingPolygon(contextReal, contextDraft);
        });
        $("#drawing-triangle").click(() => {
          currentFunction = new DrawingTriangle(contextReal, contextDraft);
        });
        $("#drawing-straight-line").click(() => {
          currentFunction = new DrawingStraightLine(contextReal, contextDraft);
        });
        $("#fill-bucket").click(() => {
          currentFunction = new FillBucket(contextReal, contextDraft);
        });
        $("#selection").click(() => {
          currentFunction = new Selection(contextReal, contextDraft);
        });
        $("#game").click(() => {
          currentFunction = new Game(contextReal, canvasReal);
          $("#canvas-draft").css("z-index", "4");
        });
        $("#drawing-quadratic-curve").click(() => {
          currentFunction = new DrawingQuadraticCurve(
            contextReal,
            contextDraft
          );
        });
        $("#drawing-bezier-curve").click(() => {
          currentFunction = new DrawingBezierCurve(contextReal, contextDraft);
        });
        $("#stamp-rectangle").click(() => {
          $(".collapse-button").toggle(500);
          let image = canvasReal.toDataURL();
          console.log(canvas);
          canvas.setBackgroundImage(image, canvas.renderAll.bind(canvas), {
            // // Optionally add an opacity lvl to the image
            backgroundImageOpacity: 1,
            // // should the image be resized to fit the container?
            backgroundImageStretch: false,
            backgroundSize: 50,
            backgroundPosition: "left top",
            backgroundWidth: 700,
            backgroundHeight: 500,
            // // Needed to position backgroundImage at 0/0
            originX: "left",
            originY: "top",
            // scaleX: canvas.width / image.width,
            // scaleY: canvas.height / image.height,
          });
        });
        // to enable drawing after stamp is initiated
        let ourDrawFunction = $(".side-car").children().length;
        for (let i = 0; i < ourDrawFunction - 2; i++) {
          $(".side-car")
            .children()
            .eq(i)
            .click(() => {
              $(".upper-canvas").css("z-index", "-1");
              $("#canvas-real").css("z-index", "-1");
              $("#canvas-draft").css("z-index", "0");
            });
        }
        let click = 0;
        let fabricFunction = $("#stamp-rectangle").children().length;
        console.log(fabricFunction);
        for (let i = 0; i < fabricFunction; i++) {
          $("#stamp-rectangle")
            .children()
            .eq(i)
            .click(() => {
              if (click === 0) {
                $(".upper-canvas").css("z-index", "0");
                $("#canvas-draft").css("z-index", "-1");
                click = 1;
              } else if (click === 1) {
                $(".upper-canvas").css("z-index", "3");
                $("#canvas-draft").css("z-index", "2");
                click = 0;
              }
            });
        }
      });
    </script>
  </body>
</html>
